{{/* 
Displays the definition for the specified term from glossaryitems.json as a tooltip.

Example usage:
{{< tooltip >}}CorDapp{{< /tooltip >}}

NOTE: The term is matched case-insensitively, and simple plurals are matched too.
*/}}

<style>
    .definition {
        visibility: hidden;
        width: 300px;
        background-color: #555;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px;
        position: absolute;
        z-index: 1200;
        bottom: 125%;
        left: 50%;
        margin-left: -150px;
        opacity: 0;
        transition: opacity 0.3s;
    }
    .term {
        position: relative;
        display: inline;
        border-bottom: 1px dotted black;
        text-decoration: none !important;  
    }
    .term:hover .definition {
        visibility: visible;
        opacity: 1;
    }
    .term .definition::after {
        content: " ";
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: #555 transparent transparent transparent;
    }
</style>

{{ $searchterm := trim .Inner " \t\n\r" }}
{{ $searchtermlower := lower $searchterm }}
{{ $searchtermkebab := replace $searchtermlower " " "-" }}

{{/* Use latest Corda 5 version if page doesn't specify one */}}
{{ $versionfolder := replace (index .Site.Params.corda5versions 0) "Corda " "corda/" }}
{{ with .Page.Params.version }}
    {{ $versionfolder = replace (lower .) " " "/" }}
{{ end }}

{{/* Adjust file path to use Hugo's assets pipeline */}}
{{ $filepath := printf "en/platform/%s/glossaryitems.json" $versionfolder }}

{{ $termlink := printf "%sen/platform/%s/reference/glossary.html#" .Site.BaseURL $versionfolder | safeURL }}

{{ with resources.Get $filepath }}
    {{ $glossarylist := . | transform.Unmarshal }}

    {{ range $term, $value := $glossarylist }}
        {{ $termlower := lower $term }}

        {{ if eq $termlower $searchtermlower }}
            {{ $termlink = printf "%s%s" $termlink $searchtermkebab }}
            <a class="term" href='{{ $termlink }}'>&nbsp;{{ $searchterm }}
                <span class="definition">{{ $value.definition }}</span>
            </a>

        {{ else if eq $termlower (strings.TrimSuffix "s" $searchtermlower) }}
            {{ $termroot := strings.TrimSuffix "s" $searchtermkebab }}
            {{ $termlink = printf "%s%s" $termlink $termroot }}
            <a class="term" href='{{ $termlink }}'>&nbsp;{{ $searchterm }}
                <span class="definition">{{ $value.definition }}</span>
            </a>
        {{ end }}
    {{ end }}
{{ else }}
    <span class="term">{{ $searchterm }}
        <span class="definition">Glossary data not found for this version.</span>
    </span>
{{ end }}
