{{/*
  Usage:
  {{< cordalatestrelref "enterprise/notary/db-guidelines.md" "Link text" "1.2.3" >}}

  Arguments:
    0 = target page path (e.g. "enterprise/notary/db-guidelines.md" or without `.md`), relative to the Corda version folder
    1 = link text (currently required; could be enhanced to default to page title)
    2 = version (optional; defaults to latest from site.Params.corda4versions)
*/}}

{{- $rawTarget := .Get 0 -}}
{{- $text := .Get 1 -}}
{{- $version := .Get 2 | default (replace (index .Site.Params.corda4versions 0) "Corda " "") -}}

{{/* Normalize path separators and strip .md suffix */}}
{{- $target := replace $rawTarget "\\" "/" -}}
{{- $target = strings.TrimSuffix ".md" $target -}}

{{/* Construct relative path from content root without /content prefix and without .md */}}
{{- $relPath := printf "en/platform/corda/%s/%s" $version $target -}}

{{- with $rel := $relPath | relref . -}}
  <a href="{{ $rel }}">{{ $text }}</a>
{{- else -}}
  <span style="color:red;">Link not found: {{ $relPath }}</span>
{{- end }}