<HTML>
<HEAD>
<meta charset="UTF-8">
<title>ServiceHub - corda</title>
<link rel="stylesheet" href="../../../style.css">

<meta name="docsearch:language" content="en">
<meta name="docsearch:version" content="3.3">
<meta name="docsearch:project" content="corda-enterprise">
</head>
<BODY>
<a href="../../index.html">corda</a>&nbsp;/&nbsp;<a href="../index.html">net.corda.core.node</a>&nbsp;/&nbsp;<a href="./index.html">ServiceHub</a><br/>
<br/>
<h1>ServiceHub</h1>
<code><span class="keyword">interface </span><span class="identifier">ServiceHub</span>&nbsp;<span class="symbol">:</span>&nbsp;<a href="../-services-for-resolution/index.html"><span class="identifier">ServicesForResolution</span></a></code>
<p>A service hub is the starting point for most operations you can do inside the node. You are provided with one
when a class annotated with <a href="../../net.corda.core.node.services/-corda-service/index.html">CordaService</a> is constructed, and you have access to one inside flows. Most RPCs
simply forward to the services found here after some access checking.</p>
<p>The APIs are organised roughly by category, with a few very important top level APIs available on the ServiceHub
itself. Inside a flow, it's safe to keep a reference to services found here on the stack: checkpointing will do the
right thing (it won't try to serialise the internals of the service).</p>
<p>In unit test environments, some of those services may be missing or mocked out.</p>
<h3>Properties</h3>
<table>
<tbody>
<tr>
<td>
<p><a href="clock.html">clock</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">val </span><span class="identifier">clock</span><span class="symbol">: </span><a href="http://docs.oracle.com/javase/8/docs/api/java/time/Clock.html"><span class="identifier">Clock</span></a></code>
<p>A <a href="http://docs.oracle.com/javase/8/docs/api/java/time/Clock.html">Clock</a> representing the node's current time. This should be used in preference to directly accessing the
clock so the current time can be controlled during unit testing.</p>
</td>
</tr>
<tr>
<td>
<p><a href="contract-upgrade-service.html">contractUpgradeService</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">val </span><span class="identifier">contractUpgradeService</span><span class="symbol">: </span><a href="../../net.corda.core.node.services/-contract-upgrade-service/index.html"><span class="identifier">ContractUpgradeService</span></a></code>
<p>The <a href="../../net.corda.core.node.services/-contract-upgrade-service/index.html">ContractUpgradeService</a> is responsible for securely upgrading contract state objects according to
a specified and mutually agreed (amongst participants) contract version.</p>
</td>
</tr>
<tr>
<td>
<p><a href="key-management-service.html">keyManagementService</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">val </span><span class="identifier">keyManagementService</span><span class="symbol">: </span><a href="../../net.corda.core.node.services/-key-management-service/index.html"><span class="identifier">KeyManagementService</span></a></code>
<p>The key management service is responsible for storing and using private keys to sign things. An
implementation of this may, for example, call out to a hardware security module that enforces various
auditing and frequency-of-use requirements.</p>
</td>
</tr>
<tr>
<td>
<p><a href="my-info.html">myInfo</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">val </span><span class="identifier">myInfo</span><span class="symbol">: </span><a href="../-node-info/index.html"><span class="identifier">NodeInfo</span></a></code>
<p>The <a href="../-node-info/index.html">NodeInfo</a> object corresponding to our own entry in the network map.</p>
</td>
</tr>
<tr>
<td>
<p><a href="network-map-cache.html">networkMapCache</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">val </span><span class="identifier">networkMapCache</span><span class="symbol">: </span><a href="../../net.corda.core.node.services/-network-map-cache/index.html"><span class="identifier">NetworkMapCache</span></a></code>
<p>A network map contains lists of nodes on the network along with information about their identity keys, services
they provide and host names or IP addresses where they can be connected to. The cache wraps around a map fetched
from an authoritative service, and adds easy lookup of the data stored within it. Generally it would be initialised
with a specified network map service, which it fetches data from and then subscribes to updates of.</p>
</td>
</tr>
<tr>
<td>
<p><a href="validated-transactions.html">validatedTransactions</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">val </span><span class="identifier">validatedTransactions</span><span class="symbol">: </span><a href="../../net.corda.core.node.services/-transaction-storage/index.html"><span class="identifier">TransactionStorage</span></a></code>
<p>A map of hash-&gt;tx where tx has been signature/contract validated and the states are known to be correct.
The signatures aren't technically needed after that point, but we keep them around so that we can relay
the transaction data to other nodes that need it.</p>
</td>
</tr>
<tr>
<td>
<p><a href="vault-service.html">vaultService</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">val </span><span class="identifier">vaultService</span><span class="symbol">: </span><a href="../../net.corda.core.node.services/-vault-service/index.html"><span class="identifier">VaultService</span></a></code>
<p>The vault service lets you observe, soft lock and add notes to states that involve you or are relevant to your
node in some way. Additionally you may query and track states that correspond to various criteria.</p>
</td>
</tr>
</tbody>
</table>
<h3>Inherited Properties</h3>
<table>
<tbody>
<tr>
<td>
<p><a href="../-services-for-resolution/attachments.html">attachments</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">val </span><span class="identifier">attachments</span><span class="symbol">: </span><a href="../../net.corda.core.node.services/-attachment-storage/index.html"><span class="identifier">AttachmentStorage</span></a></code>
<p>Provides access to storage of arbitrary JAR files (which may contain only data, no code).</p>
</td>
</tr>
<tr>
<td>
<p><a href="../-services-for-resolution/cordapp-provider.html">cordappProvider</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">val </span><span class="identifier">cordappProvider</span><span class="symbol">: </span><a href="../../net.corda.core.cordapp/-cordapp-provider/index.html"><span class="identifier">CordappProvider</span></a></code>
<p>Provides access to anything relating to cordapps including contract attachment resolution and app context</p>
</td>
</tr>
<tr>
<td>
<p><a href="../-services-for-resolution/identity-service.html">identityService</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">val </span><span class="identifier">identityService</span><span class="symbol">: </span><a href="../../net.corda.core.node.services/-identity-service/index.html"><span class="identifier">IdentityService</span></a></code>
<p>An identity service maintains a directory of parties by their associated distinguished name/public keys and thus
supports lookup of a party given its key, or name. The service also manages the certificates linking confidential
identities back to the well known identity (i.e. the identity in the network map) of a party.</p>
</td>
</tr>
<tr>
<td>
<p><a href="../-services-for-resolution/network-parameters.html">networkParameters</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">val </span><span class="identifier">networkParameters</span><span class="symbol">: </span><a href="../-network-parameters/index.html"><span class="identifier">NetworkParameters</span></a></code>
<p>Returns the network parameters the node is operating under.</p>
</td>
</tr>
</tbody>
</table>
<h3>Functions</h3>
<table>
<tbody>
<tr>
<td>
<p><a href="add-signature.html">addSignature</a></p>
</td>
<td>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">addSignature</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$addSignature(net.corda.core.transactions.SignedTransaction, java.security.PublicKey)/signedTransaction">signedTransaction</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a><span class="symbol">, </span><span class="identifier" id="net.corda.core.node.ServiceHub$addSignature(net.corda.core.transactions.SignedTransaction, java.security.PublicKey)/publicKey">publicKey</span><span class="symbol">:</span>&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/security/PublicKey.html"><span class="identifier">PublicKey</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a></code>
<p>Helper method to append an additional signature to an existing (partially) <a href="../../net.corda.core.transactions/-signed-transaction/index.html">SignedTransaction</a>.</p>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">addSignature</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$addSignature(net.corda.core.transactions.SignedTransaction)/signedTransaction">signedTransaction</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a></code>
<p>Helper method to append an additional signature for an existing (partially) <a href="../../net.corda.core.transactions/-signed-transaction/index.html">SignedTransaction</a>
using the default identity signing key of the node.</p>
</td>
</tr>
<tr>
<td>
<p><a href="corda-service.html">cordaService</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">fun </span><span class="symbol">&lt;</span><span class="identifier">T</span>&nbsp;<span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.serialization/-serialize-as-token/index.html"><span class="identifier">SerializeAsToken</span></a><span class="symbol">&gt;</span> <span class="identifier">cordaService</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$cordaService(java.lang.Class((net.corda.core.node.ServiceHub.cordaService.T)))/type">type</span><span class="symbol">:</span>&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Class.html"><span class="identifier">Class</span></a><span class="symbol">&lt;</span><a href="corda-service.html#T"><span class="identifier">T</span></a><span class="symbol">&gt;</span><span class="symbol">)</span><span class="symbol">: </span><a href="corda-service.html#T"><span class="identifier">T</span></a></code>
<p>Return the singleton instance of the given Corda service type. This is a class that is annotated with
<a href="../../net.corda.core.node.services/-corda-service/index.html">CordaService</a> and will have automatically been registered by the node.</p>
</td>
</tr>
<tr>
<td>
<p><a href="create-signature.html">createSignature</a></p>
</td>
<td>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">createSignature</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$createSignature(net.corda.core.transactions.SignedTransaction, java.security.PublicKey)/signedTransaction">signedTransaction</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a><span class="symbol">, </span><span class="identifier" id="net.corda.core.node.ServiceHub$createSignature(net.corda.core.transactions.SignedTransaction, java.security.PublicKey)/publicKey">publicKey</span><span class="symbol">:</span>&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/security/PublicKey.html"><span class="identifier">PublicKey</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="../../net.corda.core.crypto/-transaction-signature/index.html"><span class="identifier">TransactionSignature</span></a></code>
<p>Helper method to create an additional signature for an existing (partially) <a href="../../net.corda.core.transactions/-signed-transaction/index.html">SignedTransaction</a>. Additional
<a href="../../net.corda.core.crypto/-signature-metadata/index.html">SignatureMetadata</a>, including the
platform version used during signing and the cryptographic signature scheme use, is added to the signature.</p>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">createSignature</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$createSignature(net.corda.core.transactions.SignedTransaction)/signedTransaction">signedTransaction</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="../../net.corda.core.crypto/-transaction-signature/index.html"><span class="identifier">TransactionSignature</span></a></code>
<p>Helper method to create a signature for an existing (partially) <a href="../../net.corda.core.transactions/-signed-transaction/index.html">SignedTransaction</a>
using the default identity signing key of the node. The legal identity key is used to sign. Additional
<a href="../../net.corda.core.crypto/-signature-metadata/index.html">SignatureMetadata</a>, including the
platform version used during signing and the cryptographic signature scheme use, is added to the signature.</p>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">createSignature</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$createSignature(net.corda.core.transactions.FilteredTransaction, java.security.PublicKey)/filteredTransaction">filteredTransaction</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.transactions/-filtered-transaction/index.html"><span class="identifier">FilteredTransaction</span></a><span class="symbol">, </span><span class="identifier" id="net.corda.core.node.ServiceHub$createSignature(net.corda.core.transactions.FilteredTransaction, java.security.PublicKey)/publicKey">publicKey</span><span class="symbol">:</span>&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/security/PublicKey.html"><span class="identifier">PublicKey</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="../../net.corda.core.crypto/-transaction-signature/index.html"><span class="identifier">TransactionSignature</span></a></code>
<p>Helper method to create a signature for a FilteredTransaction. Additional <a href="../../net.corda.core.crypto/-signature-metadata/index.html">SignatureMetadata</a>, including the
platform version used during signing and the cryptographic signature scheme use, is added to the signature.</p>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">createSignature</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$createSignature(net.corda.core.transactions.FilteredTransaction)/filteredTransaction">filteredTransaction</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.transactions/-filtered-transaction/index.html"><span class="identifier">FilteredTransaction</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="../../net.corda.core.crypto/-transaction-signature/index.html"><span class="identifier">TransactionSignature</span></a></code>
<p>Helper method to create a signature for a FilteredTransaction
using the default identity signing key of the node. The legal identity key is used to sign. Additional
<a href="../../net.corda.core.crypto/-signature-metadata/index.html">SignatureMetadata</a>, including the platform version used during signing and the cryptographic signature scheme use,
is added to the signature.</p>
</td>
</tr>
<tr>
<td>
<p><a href="get-app-context.html">getAppContext</a></p>
</td>
<td>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">getAppContext</span><span class="symbol">(</span><span class="symbol">)</span><span class="symbol">: </span><a href="../../net.corda.core.cordapp/-cordapp-context/index.html"><span class="identifier">CordappContext</span></a></code>
<p>See <a href="../../net.corda.core.cordapp/-cordapp-provider/get-app-context.html">CordappProvider.getAppContext</a></p>
</td>
</tr>
<tr>
<td>
<p><a href="jdbc-session.html">jdbcSession</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">fun </span><span class="identifier">jdbcSession</span><span class="symbol">(</span><span class="symbol">)</span><span class="symbol">: </span><a href="http://docs.oracle.com/javase/8/docs/api/java/sql/Connection.html"><span class="identifier">Connection</span></a></code>
<p>Exposes a JDBC connection (session) object using the currently configured database.
Applications can use this to execute arbitrary SQL queries (native, direct, prepared, callable)
against its Node database tables (including custom contract tables defined by extending
<a href="../../net.corda.core.schemas/-queryable-state/index.html">net.corda.core.schemas.QueryableState</a>).</p>
</td>
</tr>
<tr>
<td>
<p><a href="record-transactions.html">recordTransactions</a></p>
</td>
<td>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">recordTransactions</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$recordTransactions(kotlin.Boolean, kotlin.collections.Iterable((net.corda.core.transactions.SignedTransaction)))/notifyVault">notifyVault</span><span class="symbol">:</span>&nbsp;<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-boolean/index.html"><span class="identifier">Boolean</span></a><span class="symbol">, </span><span class="identifier" id="net.corda.core.node.ServiceHub$recordTransactions(kotlin.Boolean, kotlin.collections.Iterable((net.corda.core.transactions.SignedTransaction)))/txs">txs</span><span class="symbol">:</span>&nbsp;<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-iterable/index.html"><span class="identifier">Iterable</span></a><span class="symbol">&lt;</span><a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a><span class="symbol">&gt;</span><span class="symbol">)</span><span class="symbol">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-unit/index.html"><span class="identifier">Unit</span></a></code><br/>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">recordTransactions</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$recordTransactions(kotlin.Boolean, net.corda.core.transactions.SignedTransaction, kotlin.Array((net.corda.core.transactions.SignedTransaction)))/notifyVault">notifyVault</span><span class="symbol">:</span>&nbsp;<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-boolean/index.html"><span class="identifier">Boolean</span></a><span class="symbol">, </span><span class="identifier" id="net.corda.core.node.ServiceHub$recordTransactions(kotlin.Boolean, net.corda.core.transactions.SignedTransaction, kotlin.Array((net.corda.core.transactions.SignedTransaction)))/first">first</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a><span class="symbol">, </span><span class="keyword">vararg</span> <span class="identifier" id="net.corda.core.node.ServiceHub$recordTransactions(kotlin.Boolean, net.corda.core.transactions.SignedTransaction, kotlin.Array((net.corda.core.transactions.SignedTransaction)))/remaining">remaining</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-unit/index.html"><span class="identifier">Unit</span></a></code>
<p>Stores the given <a href="../../net.corda.core.transactions/-signed-transaction/index.html">SignedTransaction</a>s in the local transaction storage and then sends them to the vault for
further processing if <a href="record-transactions.html#net.corda.core.node.ServiceHub$recordTransactions(kotlin.Boolean, kotlin.collections.Iterable((net.corda.core.transactions.SignedTransaction)))/notifyVault">notifyVault</a> is true. This is expected to be run within a database transaction.</p>
<code><span class="keyword">abstract</span> <span class="keyword">fun </span><span class="identifier">recordTransactions</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$recordTransactions(net.corda.core.node.StatesToRecord, kotlin.collections.Iterable((net.corda.core.transactions.SignedTransaction)))/statesToRecord">statesToRecord</span><span class="symbol">:</span>&nbsp;<a href="../-states-to-record/index.html"><span class="identifier">StatesToRecord</span></a><span class="symbol">, </span><span class="identifier" id="net.corda.core.node.ServiceHub$recordTransactions(net.corda.core.node.StatesToRecord, kotlin.collections.Iterable((net.corda.core.transactions.SignedTransaction)))/txs">txs</span><span class="symbol">:</span>&nbsp;<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-iterable/index.html"><span class="identifier">Iterable</span></a><span class="symbol">&lt;</span><a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a><span class="symbol">&gt;</span><span class="symbol">)</span><span class="symbol">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-unit/index.html"><span class="identifier">Unit</span></a></code>
<p>Stores the given <a href="../../net.corda.core.transactions/-signed-transaction/index.html">SignedTransaction</a>s in the local transaction storage and then sends them to the vault for
further processing if <a href="record-transactions.html#net.corda.core.node.ServiceHub$recordTransactions(net.corda.core.node.StatesToRecord, kotlin.collections.Iterable((net.corda.core.transactions.SignedTransaction)))/statesToRecord">statesToRecord</a> is not <a href="../-states-to-record/-n-o-n-e.html">StatesToRecord.NONE</a>.
This is expected to be run within a database transaction.</p>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">recordTransactions</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$recordTransactions(net.corda.core.transactions.SignedTransaction, kotlin.Array((net.corda.core.transactions.SignedTransaction)))/first">first</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a><span class="symbol">, </span><span class="keyword">vararg</span> <span class="identifier" id="net.corda.core.node.ServiceHub$recordTransactions(net.corda.core.transactions.SignedTransaction, kotlin.Array((net.corda.core.transactions.SignedTransaction)))/remaining">remaining</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-unit/index.html"><span class="identifier">Unit</span></a></code><br/>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">recordTransactions</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$recordTransactions(kotlin.collections.Iterable((net.corda.core.transactions.SignedTransaction)))/txs">txs</span><span class="symbol">:</span>&nbsp;<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-iterable/index.html"><span class="identifier">Iterable</span></a><span class="symbol">&lt;</span><a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a><span class="symbol">&gt;</span><span class="symbol">)</span><span class="symbol">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-unit/index.html"><span class="identifier">Unit</span></a></code>
<p>Stores the given <a href="../../net.corda.core.transactions/-signed-transaction/index.html">SignedTransaction</a>s in the local transaction storage and then sends them to the vault for
further processing. This is expected to be run within a database transaction.</p>
</td>
</tr>
<tr>
<td>
<p><a href="register-unload-handler.html">registerUnloadHandler</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">fun </span><span class="identifier">registerUnloadHandler</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$registerUnloadHandler(kotlin.Function0((kotlin.Unit)))/runOnStop">runOnStop</span><span class="symbol">:</span>&nbsp;<span class="symbol">(</span><span class="symbol">)</span>&nbsp;<span class="symbol">-&gt;</span>&nbsp;<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-unit/index.html"><span class="identifier">Unit</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-unit/index.html"><span class="identifier">Unit</span></a></code>
<p>Allows the registration of a callback that may inform services when the app is shutting down.</p>
</td>
</tr>
<tr>
<td>
<p><a href="sign-initial-transaction.html">signInitialTransaction</a></p>
</td>
<td>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">signInitialTransaction</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$signInitialTransaction(net.corda.core.transactions.TransactionBuilder, java.security.PublicKey)/builder">builder</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.transactions/-transaction-builder/index.html"><span class="identifier">TransactionBuilder</span></a><span class="symbol">, </span><span class="identifier" id="net.corda.core.node.ServiceHub$signInitialTransaction(net.corda.core.transactions.TransactionBuilder, java.security.PublicKey)/publicKey">publicKey</span><span class="symbol">:</span>&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/security/PublicKey.html"><span class="identifier">PublicKey</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a></code>
<p>Helper method to construct an initial partially signed transaction from a <a href="../../net.corda.core.transactions/-transaction-builder/index.html">TransactionBuilder</a>
using keys stored inside the node. Signature metadata is added automatically.</p>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">signInitialTransaction</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$signInitialTransaction(net.corda.core.transactions.TransactionBuilder)/builder">builder</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.transactions/-transaction-builder/index.html"><span class="identifier">TransactionBuilder</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a></code>
<p>Helper method to construct an initial partially signed transaction from a TransactionBuilder
using the default identity key contained in the node. The legal identity key is used to sign.</p>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">signInitialTransaction</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$signInitialTransaction(net.corda.core.transactions.TransactionBuilder, kotlin.collections.Iterable((java.security.PublicKey)))/builder">builder</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.transactions/-transaction-builder/index.html"><span class="identifier">TransactionBuilder</span></a><span class="symbol">, </span><span class="identifier" id="net.corda.core.node.ServiceHub$signInitialTransaction(net.corda.core.transactions.TransactionBuilder, kotlin.collections.Iterable((java.security.PublicKey)))/signingPubKeys">signingPubKeys</span><span class="symbol">:</span>&nbsp;<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-iterable/index.html"><span class="identifier">Iterable</span></a><span class="symbol">&lt;</span><a href="http://docs.oracle.com/javase/8/docs/api/java/security/PublicKey.html"><span class="identifier">PublicKey</span></a><span class="symbol">&gt;</span><span class="symbol">)</span><span class="symbol">: </span><a href="../../net.corda.core.transactions/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a></code>
<p>Helper method to construct an initial partially signed transaction from a <a href="../../net.corda.core.transactions/-transaction-builder/index.html">TransactionBuilder</a>
using a set of keys all held in this node.</p>
</td>
</tr>
<tr>
<td>
<p><a href="to-state-and-ref.html">toStateAndRef</a></p>
</td>
<td>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="symbol">&lt;</span><span class="identifier">T</span>&nbsp;<span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.contracts/-contract-state/index.html"><span class="identifier">ContractState</span></a><span class="symbol">&gt;</span> <span class="identifier">toStateAndRef</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServiceHub$toStateAndRef(net.corda.core.contracts.StateRef)/stateRef">stateRef</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.contracts/-state-ref/index.html"><span class="identifier">StateRef</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="../../net.corda.core.contracts/-state-and-ref/index.html"><span class="identifier">StateAndRef</span></a><span class="symbol">&lt;</span><a href="to-state-and-ref.html#T"><span class="identifier">T</span></a><span class="symbol">&gt;</span></code>
<p>Converts the given <a href="../../net.corda.core.contracts/-state-ref/index.html">StateRef</a> into a <a href="../../net.corda.core.contracts/-state-and-ref/index.html">StateAndRef</a> object.</p>
</td>
</tr>
</tbody>
</table>
<h3>Inherited Functions</h3>
<table>
<tbody>
<tr>
<td>
<p><a href="../-services-for-resolution/load-state.html">loadState</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">fun </span><span class="identifier">loadState</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServicesForResolution$loadState(net.corda.core.contracts.StateRef)/stateRef">stateRef</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.contracts/-state-ref/index.html"><span class="identifier">StateRef</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="../../net.corda.core.contracts/-transaction-state/index.html"><span class="identifier">TransactionState</span></a><span class="symbol">&lt;</span><span class="identifier">*</span><span class="symbol">&gt;</span></code>
<p>Given a <a href="../../net.corda.core.contracts/-state-ref/index.html">StateRef</a> loads the referenced transaction and looks up the specified output <a href="../../net.corda.core.contracts/-contract-state/index.html">ContractState</a>.</p>
</td>
</tr>
<tr>
<td>
<p><a href="../-services-for-resolution/load-states.html">loadStates</a></p>
</td>
<td>
<code><span class="keyword">abstract</span> <span class="keyword">fun </span><span class="identifier">loadStates</span><span class="symbol">(</span><span class="identifier" id="net.corda.core.node.ServicesForResolution$loadStates(kotlin.collections.Set((net.corda.core.contracts.StateRef)))/stateRefs">stateRefs</span><span class="symbol">:</span>&nbsp;<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-set/index.html"><span class="identifier">Set</span></a><span class="symbol">&lt;</span><a href="../../net.corda.core.contracts/-state-ref/index.html"><span class="identifier">StateRef</span></a><span class="symbol">&gt;</span><span class="symbol">)</span><span class="symbol">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-set/index.html"><span class="identifier">Set</span></a><span class="symbol">&lt;</span><a href="../../net.corda.core.contracts/-state-and-ref/index.html"><span class="identifier">StateAndRef</span></a><span class="symbol">&lt;</span><a href="../../net.corda.core.contracts/-contract-state/index.html"><span class="identifier">ContractState</span></a><span class="symbol">&gt;</span><span class="symbol">&gt;</span></code>
<p>Given a <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-set/index.html">Set</a> of <a href="../../net.corda.core.contracts/-state-ref/index.html">StateRef</a>'s loads the referenced transaction and looks up the specified output <a href="../../net.corda.core.contracts/-contract-state/index.html">ContractState</a>.</p>
</td>
</tr>
</tbody>
</table>
<h3>Extension Functions</h3>
<table>
<tbody>
<tr>
<td>
<p><a href="../../net.corda.core.utilities/kotlin.-any/context-logger.html">contextLogger</a></p>
</td>
<td>
<code><span class="keyword">fun </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-any/index.html"><span class="identifier">Any</span></a><span class="symbol">.</span><span class="identifier">contextLogger</span><span class="symbol">(</span><span class="symbol">)</span><span class="symbol">: </span><span class="identifier">Logger</span></code>
<p>When called from a companion object, returns the logger for the enclosing class.</p>
</td>
</tr>
<tr>
<td>
<p><a href="../../net.corda.finance.contracts/get-cash-balance.html">getCashBalance</a></p>
</td>
<td>
<code><span class="keyword">fun </span><a href="./index.html"><span class="identifier">ServiceHub</span></a><span class="symbol">.</span><span class="identifier">getCashBalance</span><span class="symbol">(</span><span class="identifier" id="net.corda.finance.contracts$getCashBalance(net.corda.core.node.ServiceHub, java.util.Currency)/currency">currency</span><span class="symbol">:</span>&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/util/Currency.html"><span class="identifier">Currency</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="../../net.corda.core.contracts/-amount/index.html"><span class="identifier">Amount</span></a><span class="symbol">&lt;</span><a href="http://docs.oracle.com/javase/8/docs/api/java/util/Currency.html"><span class="identifier">Currency</span></a><span class="symbol">&gt;</span></code></td>
</tr>
<tr>
<td>
<p><a href="../../net.corda.finance.contracts/get-cash-balances.html">getCashBalances</a></p>
</td>
<td>
<code><span class="keyword">fun </span><a href="./index.html"><span class="identifier">ServiceHub</span></a><span class="symbol">.</span><span class="identifier">getCashBalances</span><span class="symbol">(</span><span class="symbol">)</span><span class="symbol">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-map/index.html"><span class="identifier">Map</span></a><span class="symbol">&lt;</span><a href="http://docs.oracle.com/javase/8/docs/api/java/util/Currency.html"><span class="identifier">Currency</span></a><span class="symbol">,</span>&nbsp;<a href="../../net.corda.core.contracts/-amount/index.html"><span class="identifier">Amount</span></a><span class="symbol">&lt;</span><a href="http://docs.oracle.com/javase/8/docs/api/java/util/Currency.html"><span class="identifier">Currency</span></a><span class="symbol">&gt;</span><span class="symbol">&gt;</span></code></td>
</tr>
<tr>
<td>
<p><a href="../../net.corda.testing.node/ledger.html">ledger</a></p>
</td>
<td>
<code><span class="keyword">fun </span><a href="./index.html"><span class="identifier">ServiceHub</span></a><span class="symbol">.</span><span class="identifier">ledger</span><span class="symbol">(</span><span class="identifier" id="net.corda.testing.node$ledger(net.corda.core.node.ServiceHub, net.corda.core.identity.Party, kotlin.Function1((net.corda.testing.dsl.LedgerDSL((net.corda.testing.dsl.TestTransactionDSLInterpreter, net.corda.testing.dsl.TestLedgerDSLInterpreter)), kotlin.Unit)))/notary">notary</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.identity/-party/index.html"><span class="identifier">Party</span></a>&nbsp;<span class="symbol">=</span>&nbsp;TestIdentity.fresh("ledger notary").party<span class="symbol">, </span><span class="identifier" id="net.corda.testing.node$ledger(net.corda.core.node.ServiceHub, net.corda.core.identity.Party, kotlin.Function1((net.corda.testing.dsl.LedgerDSL((net.corda.testing.dsl.TestTransactionDSLInterpreter, net.corda.testing.dsl.TestLedgerDSLInterpreter)), kotlin.Unit)))/script">script</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.testing.dsl/-ledger-d-s-l/index.html"><span class="identifier">LedgerDSL</span></a><span class="symbol">&lt;</span><a href="../../net.corda.testing.dsl/-test-transaction-d-s-l-interpreter/index.html"><span class="identifier">TestTransactionDSLInterpreter</span></a><span class="symbol">,</span>&nbsp;<a href="../../net.corda.testing.dsl/-test-ledger-d-s-l-interpreter/index.html"><span class="identifier">TestLedgerDSLInterpreter</span></a><span class="symbol">&gt;</span><span class="symbol">.</span><span class="symbol">(</span><span class="symbol">)</span>&nbsp;<span class="symbol">-&gt;</span>&nbsp;<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-unit/index.html"><span class="identifier">Unit</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="../../net.corda.testing.dsl/-ledger-d-s-l/index.html"><span class="identifier">LedgerDSL</span></a><span class="symbol">&lt;</span><a href="../../net.corda.testing.dsl/-test-transaction-d-s-l-interpreter/index.html"><span class="identifier">TestTransactionDSLInterpreter</span></a><span class="symbol">,</span>&nbsp;<a href="../../net.corda.testing.dsl/-test-ledger-d-s-l-interpreter/index.html"><span class="identifier">TestLedgerDSLInterpreter</span></a><span class="symbol">&gt;</span></code>
<p>Creates and tests a ledger built by the passed in dsl.</p>
</td>
</tr>
<tr>
<td>
<p><a href="../../net.corda.testing.node/transaction.html">transaction</a></p>
</td>
<td>
<code><span class="keyword">fun </span><a href="./index.html"><span class="identifier">ServiceHub</span></a><span class="symbol">.</span><span class="identifier">transaction</span><span class="symbol">(</span><span class="identifier" id="net.corda.testing.node$transaction(net.corda.core.node.ServiceHub, net.corda.core.identity.Party, kotlin.Function1((net.corda.testing.dsl.TransactionDSL((net.corda.testing.dsl.TransactionDSLInterpreter)), net.corda.testing.dsl.EnforceVerifyOrFail)))/notary">notary</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.core.identity/-party/index.html"><span class="identifier">Party</span></a>&nbsp;<span class="symbol">=</span>&nbsp;TestIdentity.fresh("transaction notary").party<span class="symbol">, </span><span class="identifier" id="net.corda.testing.node$transaction(net.corda.core.node.ServiceHub, net.corda.core.identity.Party, kotlin.Function1((net.corda.testing.dsl.TransactionDSL((net.corda.testing.dsl.TransactionDSLInterpreter)), net.corda.testing.dsl.EnforceVerifyOrFail)))/script">script</span><span class="symbol">:</span>&nbsp;<a href="../../net.corda.testing.dsl/-transaction-d-s-l/index.html"><span class="identifier">TransactionDSL</span></a><span class="symbol">&lt;</span><a href="../../net.corda.testing.dsl/-transaction-d-s-l-interpreter/index.html"><span class="identifier">TransactionDSLInterpreter</span></a><span class="symbol">&gt;</span><span class="symbol">.</span><span class="symbol">(</span><span class="symbol">)</span>&nbsp;<span class="symbol">-&gt;</span>&nbsp;<a href="../../net.corda.testing.dsl/-enforce-verify-or-fail.html"><span class="identifier">EnforceVerifyOrFail</span></a><span class="symbol">)</span><span class="symbol">: </span><a href="../../net.corda.testing.dsl/-ledger-d-s-l/index.html"><span class="identifier">LedgerDSL</span></a><span class="symbol">&lt;</span><a href="../../net.corda.testing.dsl/-test-transaction-d-s-l-interpreter/index.html"><span class="identifier">TestTransactionDSLInterpreter</span></a><span class="symbol">,</span>&nbsp;<a href="../../net.corda.testing.dsl/-test-ledger-d-s-l-interpreter/index.html"><span class="identifier">TestLedgerDSLInterpreter</span></a><span class="symbol">&gt;</span></code>
<p>Creates a ledger with a single transaction, built by the passed in dsl.</p>
</td>
</tr>
</tbody>
</table>
<h3>Inheritors</h3>
<table>
<tbody>
<tr>
<td>
<p><a href="../-app-service-hub/index.html">AppServiceHub</a></p>
</td>
<td>
<code><span class="keyword">interface </span><span class="identifier">AppServiceHub</span>&nbsp;<span class="symbol">:</span>&nbsp;<a href="./index.html"><span class="identifier">ServiceHub</span></a></code>
<p>A <a href="#">CordaService</a> annotated class requires a constructor taking a
single parameter of type <a href="../-app-service-hub/index.html">AppServiceHub</a>.
With the <a href="../-app-service-hub/index.html">AppServiceHub</a> parameter a <a href="#">CordaService</a> is able to access to privileged operations.
In particular such a <a href="#">CordaService</a> can initiate and track flows marked with <a href="../../net.corda.core.flows/-startable-by-service/index.html">net.corda.core.flows.StartableByService</a>.</p>
</td>
</tr>
<tr>
<td>
<p><a href="../../net.corda.testing.node/-mock-services/index.html">MockServices</a></p>
</td>
<td>
<code><span class="keyword">open</span> <span class="keyword">class </span><span class="identifier">MockServices</span>&nbsp;<span class="symbol">:</span>&nbsp;<a href="./index.html"><span class="identifier">ServiceHub</span></a></code>
<p>An implementation of <a href="./index.html">ServiceHub</a> that is designed for in-memory unit tests of contract validation logic. It has
enough functionality to do tests of code that queries the vault, inserts to the vault, and constructs/checks
transactions. However it isn't enough to test flows and other aspects of an app that require a network. For that
you should investigate <a href="../../net.corda.testing.node/-mock-network/index.html">MockNetwork</a>.</p>
</td>
</tr>
</tbody>
</table>

<style>
    @import url("https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,500,600");
    #cookies-eu-banner {
        background-color: rgba(83, 88, 95, 0.9);
        border-radius: 3px;
        color: #fff;
        font-family: 'Source Sans Pro', sans-serif;
        font-size: 13px;
        font-weight: 400;
        left: 3px;
        position: fixed;
        padding: 6px;
        right: 3px;
        text-align: center;
        top: 100px;
        z-index: 1000;
    }
    
    #cookies-eu-banner h3,
    #cookies-eu-banner p {
        color: #fff;
        font-size: 18px;
        letter-spacing: 0;
    }
    
    #cookies-eu-banner h3 {
        font-size: 24px;
        font-style: normal;
        font-weight: 400;
        line-height: 1.2;
        margin: 9px 0 0;
        text-transform: uppercase;
    }
    
    #cookies-eu-banner p {
        margin-bottom: 10px;
        padding: 8px 36px 0;
        text-align: justify;
        line-height: 1.4em;
    }
    
    #cookies-eu-banner fieldset {
        min-width: 0;
        padding: 0;
        margin: 0;
        border: 0;
    }
    
    #cookies-eu-banner legend {
        color: inherit;
        display: block;
        font-size: 18px;
        line-height: inherit;
        max-width: 100%;
        margin-bottom: 16px;
        padding: 0;
        white-space: normal;
        width: 100%;
    }
    
    #cookies-eu-banner a {
        color: #62AAF1;
    }
    
    #cookies-eu-banner .cookies-button-group {
        display: flex;
        justify-content: center;
    }
    
    #cookies-eu-accept,
    #cookies-eu-accept-all {
        background-color: #ec1d24;
        border: none;
        border-radius: 6px;
        color: #fff;
        font-size: 12px;
        font-weight: 600;
        margin: 0 10px 10px;
        max-height: 40px;
        height: 40px;
        line-height: 1.1;
        text-decoration: none;
        width: 150px;
    }
    
    .cookies-checkbox {
        display: inline-block;
        margin: 5px 10px;
    }
    
    .cookies-checkbox label {
        font-size: 16px;
        margin-left: 3px;
    }
    
    @media screen and (min-width: 768px) {
        #cookies-eu-banner {
            bottom: 5px;
            top: inherit;
        }
        #cookies-eu-accept,
        #cookies-eu-accept-all {
            font-size: 14px;
        }
    }
</style>
<div id="cookies-eu-banner" style="display: none;">
    <h3 style="text-transform:none">Your privacy</h3>
    <div class='cookie-flex'>
        <p>
            We use cookies to improve your experience on our site, and to help us understand how people use our documentation. For more detailed information, see our <a href="https://www.r3.com/privacy-policy/">privacy policy</a> and <a href="#">cookie declaration</a>.
        </p>
        <form id='cookie-consent-form'>
            <fieldset>
                <legend>
                    Please select from the following options to continue to our site.
                </legend>
                <div class='cookies-button-group'>
                    <button id="cookies-eu-accept" type="button">
                      Allow cookies selected
                    </button>
                    <button id="cookies-eu-accept-all" type="button">
                      Allow all cookies
                    </button>
                    <span class='cookies-checkbox'>
                      <input
                      type="checkbox"
                      id="necessary"
                      name="necessary"
                      autocomplete="off"
                      checked
                      disabled />
                        <input
                        name="necessary"
                        type="hidden"
                        value="on"/>
                        <label for="necessary">Necessary</label>
                    </span>
                    <span class='cookies-checkbox'>
                      <input
                      type="checkbox"
                      id="preferences"
                      name="preferences"
                      autocomplete="off" />
                      <label for="preferences">Preferences</label>
                    </span>
                    <span class='cookies-checkbox'>
                      <input
                      type="checkbox"
                      id="statistics"
                      name="statistics"
                      autocomplete="off" />
                      <label for="statistics">Statistics</label>
                    </span>
                    <span class='cookies-checkbox'>
                      <input
                      type="checkbox"
                      id="marketing"
                      name="marketing"
                      autocomplete="off" />
                      <label for="marketing">Marketing</label>
                    </span>
                </div>
            </fieldset>
        </form>
    </div>
</div>
<script class='api-keys'>
    var gaKey = 'UA-87760032-1';
    var algolia_appId = "UX2KMUWFAL";
    var algolia_apiKey = "1fe3367db02689b4aeebc59efad5abaf";
    var algolia_index = "docs.corda.net";
</script>
<script class='cookies-eu-banner'>
    ! function(root, factory) {
        "use strict";
        "function" == typeof define && define.amd ? define([], factory) : "object" == typeof exports ? module.exports = factory() : root.CookiesEuBanner = factory()
    }(window, function() {
        "use strict";
        var document = window.document,
            CookiesEuBanner = function(launchFunction, waitAccept, useLocalStorage, undefined) {
                if (!(this instanceof CookiesEuBanner)) return new CookiesEuBanner(launchFunction);
                this.cookieTimeout = 33696e6, this.bots = /bot|crawler|spider|crawling/i, this.cookieName = "hasConsent", this.trackingCookiesNames = ["__utma", "__utmb", "__utmc", "__utmt", "__utmv", "__utmz", "_ga", "_gat", "_gid"], this.launchFunction = launchFunction, this.waitAccept = waitAccept || !1, this.useLocalStorage = useLocalStorage || !1, this.init()
            };
        return CookiesEuBanner.prototype = {
            init: function() {
                var isBot = this.bots.test(navigator.userAgent);
                navigator.doNotTrack || navigator.msDoNotTrack || window.doNotTrack;
                return isBot || !1 === this.hasConsent() ? (this.removeBanner(0), !1) : !0 === this.hasConsent() ? (this.launchFunction(), !0) : (this.showBanner(), void(this.waitAccept || this.setConsent(!0)))
            },
            showBanner: function() {
                var _this = this,
                    getElementById = document.getElementById.bind(document),
                    banner = getElementById("cookies-eu-banner"),
                    rejectButton = getElementById("cookies-eu-reject"),
                    acceptButton = getElementById("cookies-eu-accept"),
                    moreLink = getElementById("cookies-eu-more"),
                    waitRemove = void 0 === banner.dataset.waitRemove ? 0 : parseInt(banner.dataset.waitRemove),
                    addClickListener = this.addClickListener,
                    removeBanner = _this.removeBanner.bind(_this, waitRemove);
                banner.style.display = "block", moreLink && addClickListener(moreLink, function() {
                    _this.deleteCookie(_this.cookieName)
                }), acceptButton && addClickListener(acceptButton, function() {
                    removeBanner(), _this.setConsent(!0), _this.launchFunction()
                }), rejectButton && addClickListener(rejectButton, function() {
                    removeBanner(), _this.setConsent(!1), _this.trackingCookiesNames.map(_this.deleteCookie)
                })
            },
            setConsent: function(consent) {
                if (this.useLocalStorage) return localStorage.setItem(this.cookieName, consent);
                this.setCookie(this.cookieName, consent)
            },
            hasConsent: function() {
                function isCookieSetTo(value) {
                    return -1 < document.cookie.indexOf(cookieName + "=" + value) || localStorage.getItem(cookieName) === value
                }
                var cookieName = this.cookieName;
                return !!isCookieSetTo("true") || !isCookieSetTo("false") && null
            },
            setCookie: function(name, value) {
                var date = new Date;
                date.setTime(date.getTime() + this.cookieTimeout), document.cookie = name + "=" + value + ";SameSite=Strict;expires=" + date.toGMTString() + ";path=/"
            },
            deleteCookie: function(name) {
                var hostname = document.location.hostname.replace(/^www\./, ""),
                    commonSuffix = "; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/";
                document.cookie = name + "=; domain=." + hostname + commonSuffix, document.cookie = name + "=" + commonSuffix
            },
            addClickListener: function(DOMElement, callback) {
                if (DOMElement.attachEvent) return DOMElement.attachEvent("onclick", callback);
                DOMElement.addEventListener("click", callback)
            },
            removeBanner: function(wait) {
                setTimeout(function() {
                    var banner = document.getElementById("cookies-eu-banner");
                    banner && banner.parentNode && banner.parentNode.removeChild(banner)
                }, wait)
            }
        }, CookiesEuBanner
    });
</script>
<script class='google-analytics'>
    function googleAnalytics() {
        var i, s, o, r, a, m;
        i = window, s = document, o = "script", r = "ga", i.GoogleAnalyticsObject = r, i.ga = i.ga || function() {
            (i.ga.q = i.ga.q || []).push(arguments)
        }, i.ga.l = +new Date, a = s.createElement(o), m = s.getElementsByTagName(o)[0], a.async = 1, a.src = "//www.google-analytics.com/analytics.js", m.parentNode.insertBefore(a, m), window.ga("create", "UA-87760032-1", "auto"), window.ga("send", "pageview")
    }
</script>
<script class='docSearchInit'>
    function docSearchInit() {
        var algoliaOptions;
        document.querySelector("#search-input") && (algoliaOptions = {
            hitsPerPage: 5,
            facetFilters: facetFilters
        }, /404.html/.test(window.location.pathname) && delete algoliaOptions.facetFilters, window.docsearch({
            appId: algolia_appId,
            apiKey: algolia_apiKey,
            indexName: algolia_index,
            inputSelector: "#search-input",
            algoliaOptions: algoliaOptions
        }))
    }
</script>
<script class='corda-cookie-banner'>
    const docsearchLoad = (resolve, reject) => {
        const script = document.createElement('script');
        document.body.appendChild(script);
        script.onload = resolve;
        script.onerror = reject;
        script.async = true;
        script.src = "https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.js";
    };

    class DocsiteCookies {
        constructor() {
            this.name = 'corda_cookie';
            this.cookiesAccepted = {
                set: true,
                necessary: true,
                preferences: false,
                statistics: false,
                marketing: false
            };
            this.form = document.querySelector('#cookie-consent-form');
            this.handleAllCookies();

            new CookiesEuBanner(() => {
                this.cookieBanner();
            }, true);
        }

        handleAllCookies() {
            const acceptButton = document.querySelector('#cookies-eu-accept');
            const allCookiesButton = document.querySelector('#cookies-eu-accept-all');

            allCookiesButton.addEventListener('click', e => {
                e.preventDefault();
                this.allowAllCookies(this.form);
                acceptButton.click();
            });
        }

        cookieBanner() {
            if (!this.checkConsent()) {
                this.formToCookie(this.name, this.form);
                this.setAdditionalServices();
            } else {
                this.setAdditionalServices();
            }
        }

        allowAllCookies(form) {
            let cookiePreferences = form.querySelectorAll('.cookies-checkbox');
            for (let cookie of cookiePreferences) {
                cookie.querySelector('input').checked = true;
            }
        }

        formToCookie(name, form) {
            const thirteenMonthsInMils = 31104000000;

            let date = new Date();
            date.setTime(date.getTime() + thirteenMonthsInMils);

            let formData = new FormData(form);
            for (var pair of formData.entries()) {
                switch (pair[0]) {
                    case "necessary":
                        this.cookiesAccepted.necessary = (pair[1] === 'on') ?
                            true :
                            false;
                        break;
                    case "preferences":
                        this.cookiesAccepted.preferences = (pair[1] === 'on') ?
                            true :
                            false;
                        break;
                    case "statistics":
                        this.cookiesAccepted.statistics = (pair[1] === 'on') ?
                            true :
                            false;
                        break;
                    case "marketing":
                        this.cookiesAccepted.marketing = (pair[1] === 'on') ?
                            true :
                            false;
                        break;
                    default:
                        break;
                }
            }
            let cookieValue = JSON.stringify(this.cookiesAccepted);

            document.cookie = `${name}=${cookieValue};SameSite=Strict;expires=${date.toGMTString()};path=/`;
        }

        checkConsent() {
            let cookieName = this.name;
            let cookieValue = this.getCookie(cookieName);

            if (cookieValue) {
                if (cookieValue.set === true) {
                    return true;
                } else {
                    return false;
                }
            } else {
                return false;
            }
        }

        getCookie(name) {
            let value = "; " + document.cookie;
            let parts = value.split("; " + name + "=");
            let cValue = "";

            if (parts.length == 2) {
                cValue = parts.pop().split(";").shift();
            }

            if (hasJsonStructure(cValue)) {
                return JSON.parse(cValue);
            } else {
                return cValue;
            }
        }

        setAdditionalServices() {
            let cookieConsent = this.getCookie(this.name);
            for (let [key, value] of Object.entries(cookieConsent)) {
                if (key === 'necessary' && value === true) {
                    new Promise(docsearchLoad)
                        .then(() => {
                            docSearchInit();
                        })
                        .catch(err => console.log(err));
                }
                if (key === 'statistics' && value === true) {
                    googleAnalytics();
                }
            }
        }
    }

    function hasJsonStructure(str) {
        if (typeof str !== 'string') return false;
        try {
            const result = JSON.parse(str);
            const type = Object.prototype.toString.call(result);
            return type === '[object Object]' ||
                type === '[object Array]';
        } catch (err) {
            return false;
        }
    }
</script>
<script class='initialise'>
    new DocsiteCookies();
</script>
</body>
</HTML>
